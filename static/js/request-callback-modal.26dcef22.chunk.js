(this["webpackJsonpveho-react"]=this["webpackJsonpveho-react"]||[]).push([[127],{1547:function(e,t,a){"use strict";a.r(t);var n=a(11),i=a(1),l=a(0),r=a.n(l),o=a(28),s=a(138),c=a(579),m=a(68),d=a(38),u=a(39),b=a(58),h=a(46),g=a(56),p=a(29),v=a(54),f=a(35),y=a.n(f),O=a(624),I=a.n(O),C=a(625),k=a.n(C),N=a(31),j=a(613),E=a(176),S=a(267),w=a(354),_=a(593),D=a(172),R=a(1947),M=a(483),x=a(15),L=a(93),P=a(14),T=a(23),B=(a(1895),a(145)),A=a(290),F=a.n(A);function q(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=Object(p.a)(e);if(t){var i=Object(p.a)(this).constructor;a=Reflect.construct(n,arguments,i)}else a=n.apply(this,arguments);return Object(g.a)(this,a)}}var U=x.a.api_url,V=function(e){Object(h.a)(a,e);var t=q(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).state={stateValue:"",name:"",email:"",mobileNumber:"",countryPhoneCode:"+91",enableCallback:!1,validationState:{mobileNumberInvalid:!1,nameInvalid:!1,emailInvalid:!1}},n.handleInputChange=n.handleInputChange.bind(Object(b.a)(n)),n.handleSubmit=n.handleSubmit.bind(Object(b.a)(n)),n.handelOnChange=n.handelOnChange.bind(Object(b.a)(n)),n.triggerValidation=n.triggerValidation.bind(Object(b.a)(n)),n.autoFillDetails=n.autoFillDetails.bind(Object(b.a)(n)),n._successMessage=n.props.successMsg||"Thanks! We will call you within 48 hours.",n}return Object(u.a)(a,[{key:"componentWillReceiveProps",value:function(e){this.autoFillDetails(e)}},{key:"componentDidMount",value:function(){Object(w.a)(),this.autoFillDetails(this.props)}},{key:"autoFillDetails",value:function(e){var t=this,a=JSON.parse(localStorage.getItem("callbackDetails")),n=e.user_details&&e.user_details.loggedIn?e.user_details:a&&a.data;n&&n.name&&!this.state.name.length&&this.setState({name:n.name.charAt(0).toUpperCase()+n.name.slice(1),mobileNumber:n.countryPhoneCode+n.mobileNumber},(function(){t.handleEnableCallback()}))}},{key:"handelOnChange",value:function(e){var t=this,a="+91";if(e=e||"",Object(E.a)(e)){var n=Object(S.a)();a="+",a+=Object(M.parseNumber)(e,{extended:!0},n).countryCallingCode}this.setState({mobileNumber:e,countryPhoneCode:a},(function(){t.handleEnableCallback()}))}},{key:"triggerValidation",value:function(){var e=this.state.validationState,t=this.state,a=t.name,n=t.mobileNumber,i=t.email;return e.mobileNumberInvalid=!Object(E.a)(n),e.nameInvalid=!a.trim().length,e.emailInvalid=!(i.trim().length&&Object(B.d)(i)),this.setState({validationState:e}),I()(k()(e),(function(e){return!e}))}},{key:"handleSubmit",value:function(){var e=this,t=this;if(this.triggerValidation()){var a=this.state,n=a.name,l=a.mobileNumber,r=a.countryPhoneCode,o=a.email,s=this.props,c=s.vacations,m=s.itineraryInfo,d=s.location,u=s.history,b=s.lastLocation,h=s.user_details,g=s.packages,p={},v=Object.keys(c.content.campaignDetails||{}).length>0?c.content.campaignDetails.regionCode:"";Object.keys(c||{}).length&&Object.keys(c.content||{}).length&&(p.region_code=v,p.region_name=Object.keys(c.content.campaignDetails||{}).length>0?c.content.campaignDetails.region:""),!p.region_name&&g&&(p.region_name=(g.campaignDetails||"").key.split("/")[1]),Object(P.he)(P.E,Object(i.a)({name:n,already_logged_in:(h||{loggedIn:!1}).loggedIn,phone:l,itinerary_id:y,pageURL:document.location.href},p));var f=l.replace(/\D/g,"").substr(r.replace("+","").length),y=m&&m.itinerary&&m.itinerary.itineraryId,O={name:n,mobileNumber:f,email:o,itineraryId:y,pageUrl:d.pathname,countryPhoneCode:r};m&&m.campaignItineraryId&&(O.campaignId=m.campaignItineraryId),O.leadSource=Object(L.b)({history:u,lastLocation:b,itineraryId:y,isCBR:!0,rc:v}),c&&c.content&&(O.regionCode=v);var I="".concat(U,"itinerary/requestcallbackuser");Object(T.a)({url:I,method:"POST",body:O,onSuccess:function(a){var n;"SUCCESS"===a.status?(localStorage.removeItem("wwmib_pwa_cbr"),h.loggedIn||t.props.actions.getUserDetails(),t.props.actions.manageSoftNotification({show_notification:!0,message:t._successMessage,show_undo:!1}).then((function(){t.props.closeModal()})).catch((function(){t.props.closeModal()})),!Object(N.a)()&&window.gtag&&window.gtag("event","request_call_back",{event_category:"engagement",event_label:"method",value:"0"}),sessionStorage.setItem("CBRPackExitpopup",!1),sessionStorage.removeItem("triggeredCBRFromChat"),localStorage.setItem("callbackDetails",JSON.stringify({data:O}))):(a.message?n=a.message:(n="Can't send call back request please check the credentials given and check again","MOBILE_EXISTS"===a.status||"EMAIL_EXISTS"===a.status?n="An account with the given credentials already exists please login or provide different credentials to continue.":"INVALID_EMAIL"===a.status&&(n="The given email is invalid please provid a valid email")),e.setState({showAlert:!0,postCardErrorMessage:n,postCardErrorTitle:a.title?a.title:"Oops!"}))}})}}},{key:"handleInputChange",value:function(e){var t=this,a=e.target,n=a.name;if("name"===a.name&&a.value.length&&!Object(j.a)(a.value))return!1;this.setState(Object(m.a)({},n,a.value),(function(){t.handleEnableCallback()}))}},{key:"handleEnableCallback",value:function(){var e=this.state,t=e.name,a=e.mobileNumber,n=e.email,i=(this.props.user_details,!Object(E.a)(a)),l=!t.trim().length,r=!(n.trim().length&&Object(B.d)(n));this.setState({enableCallback:!(i||l||r)})}},{key:"render",value:function(){var e=this,t=this.state.validationState,a=this.state.enableCallback,n=this.props.user_details;return r.a.createElement("div",{tabIndex:"0",className:"modal mini-modal fade gettrip-and-callback modal-sticky-header "+(this.props.showModal?"in":"")},r.a.createElement("div",{className:"modal-dialog"},r.a.createElement("div",{className:"modal-content with-header"},r.a.createElement("div",{className:"modal-header"},r.a.createElement("button",{type:"button",onClick:this.props.closeModal,className:"btn-modal-close close","aria-label":"Close"},r.a.createElement("span",{className:" pyt-close-16","aria-hidden":"true"}))),r.a.createElement("div",{className:"modal-body"},r.a.createElement("div",{className:"row row-vertical-center"},r.a.createElement("div",{className:"col-sm-12 double-spacer-top-sm"},r.a.createElement("h5",{className:"large-heading bold mt-0 mbottom-large font-serif",style:{lineHeight:1.3}},this.props.title?this.props.title:r.a.createElement(l.Fragment,null,"Get limited access",r.a.createElement("br",null),"price privileges?")),r.a.createElement("form",{id:"request-callback-modal",className:"fw"},r.a.createElement("div",{className:y()("form-group",{"has-error":t.nameInvalid})},r.a.createElement("div",{className:"clearfix label-link"},r.a.createElement("label",{className:"control-label"},"Your name")),r.a.createElement("input",{type:"text",className:"form-control",required:!0,name:"name",onBlur:function(){var t=e.state,a=t.validationState,n=t.name;a.nameInvalid=!n.trim().length,e.setState({validationState:a})},value:this.state.name,onChange:function(t){return e.handleInputChange(t)},disabled:(n||{}).loggedIn})),r.a.createElement("div",{className:y()("form-group",{"has-error":t.mobileNumberInvalid})},r.a.createElement("div",{className:"clearfix label-link"},r.a.createElement("label",{className:"control-label"},"Mobile number")),r.a.createElement(R.a,{displayInitialValueAsLocalNumber:!1,disabled:(n||{}).loggedIn,country:"IN",value:this.state.mobileNumber,name:"request-callback-mobile-number",error:this.state.mobileNumber?Object(E.a)(this.state.mobileNumber)?void 0:"Invalid phone number":void 0,onBlur:function(){var t=e.state,a=t.validationState,n=t.mobileNumber;a.mobileNumberInvalid=!Object(E.a)(n),e.setState({validationState:a})},indicateInvalid:!0,saveOnIcons:!1,smartCaret:!1,onChange:this.handelOnChange})),r.a.createElement("div",{className:y()("form-group",{"has-error":t.emailInvalid,disabled:(n||{}).loggedIn})},r.a.createElement("div",{className:"clearfix label-link"},r.a.createElement("label",{className:"control-label"},"Email")),r.a.createElement("input",{type:"email",className:"form-control",required:!0,name:"email",onBlur:function(){var t=e.state,a=t.validationState,n=t.email,i=void 0===n?"":n;a.emailInvalid=!(i.trim().length&&Object(B.d)(i)),e.setState({validationState:a})},value:this.state.email,onChange:function(t){return e.handleInputChange(t)},disabled:(n||{}).loggedIn})),r.a.createElement("div",{className:"vpadding-small pb-0"},r.a.createElement("button",{className:"btn btn-lg btn-primary btn-block n-tracker-rcb-submit"+(a?"":" disabled"),disabled:!a,onClick:this.handleSubmit,type:"button"},this.props.ctaText||"Keep me informed")))))))),r.a.createElement(F.a,{show:this.state.showAlert,title:this.state.postCardErrorTitle,text:this.state.postCardErrorMessage,animation:"pop",onConfirm:function(){return e.setState({showAlert:!1})}}))}}],[{key:"getDerivedStateFromProps",value:function(e,t){var a=e.user_details||{},n=a.email,i=a.name,l=a.mobileNumber,r=a.countryPhoneCode,o=a.loggedIn;return n&&t.email!==n?{name:i||"",email:n||"",mobileNumber:(r||"")+(l||""),countryPhoneCode:r,enableCallback:o}:null}}]),a}(l.Component),G=Object(s.withLastLocation)(Object(o.c)((function(e){return{user_details:e.app.user_details}}),(function(e){return{actions:{manageSoftNotification:Object(v.b)(_.a,e),getUserDetails:Object(v.b)(D.a,e)}}}))(V)),J=a(214),K=a(217),W=a(342),X=a(7);a(1610),t.default=Object(s.withLastLocation)(Object(o.c)((function(e){var t,a=e.app,n=e.maldivesData,i=void 0===n?{}:n,o=e.packages,s=void 0===o?{}:o,c=s.content,m=null,d=null;if(c&&"object"===typeof c&&Object.keys(c).length){var u=c.campaignDetails;m=(void 0===u?{}:u).paid}return!Object(N.a)()&&window&&(window.location&&window.location.href||"").indexOf(X.gb.LANDING_ROUTE)>-1||i&&(i.preCostedResorts&&Object.keys(i.preCostedResorts).length||i.categoryResorts&&Object.keys(i.categoryResorts))?(m=!0,d=r.a.createElement(l.Fragment,null,"Get exclusive Maldives deals"),t="Thanks! Our Maldives consultant will get in touch with you within 48 hours."):d=r.a.createElement(l.Fragment,null,"Get limited access",r.a.createElement("br",null),"price privileges?"),{isNewCBR:m,title:d,successMsg:t,ctaText:"Keep me informed",maldivesData:i,itineraryInfo:a.itineraryInfo,vacations:s,user_details:a.user_details}}))((function(e){var t=e.location,a=t.pathname.split("/").includes("request-whatsapp-chat");if(e=Object(i.a)(Object(i.a)({},e),{},{chatRequested:a}),t&&"string"===typeof t.search&&t.search.indexOf("autocbr")>-1&&e.isNewCBR){var o=Object(l.useState)(!1),s=Object(n.a)(o,2),m=s[0],d=s[1];Object(l.useEffect)((function(){return d(!0),Object(W.a)(),document.addEventListener("keyup",u),function(){document.removeEventListener("keyup",u)}}),[]);var u=function(e){27===e.keyCode&&b()},b=function(){var t=e,a=t.history,n=t.location,i=t.itineraryInfo,l=t.vacations,r=t.maldivesData;setTimeout((function(){d(!1),Object(J.a)();try{if(sessionStorage.setItem("CBRPackExitpopup",!1),r&&r.preCostedResorts&&Object.keys(r.preCostedResorts).length||n&&(n.pathname||"").indexOf(X.gb.LANDING_ROUTE)>-1||r.categoryResorts&&Object.keys(r.categoryResorts).length||l&&l.content||i&&i.itinerary&&i.itinerary.campaign){var e="/".concat(Object(K.a)(n.pathname)),t=(n.search||"").replace("&autocbr","");a?a.push(e+t):window.location.href=e+t}else i&&i.itinerary?a.push(Object(X.Nb)({itineraryId:i.itinerary.itineraryId,regionCode:i.itinerary.regionCode,location:n})):a.push("/")}catch(o){}}),400)};return r.a.createElement(G,Object.assign({},e,{showModal:m,closeModal:b}))}return r.a.createElement(c.b,e)})))},1610:function(e,t,a){},1895:function(e,t,a){}}]);